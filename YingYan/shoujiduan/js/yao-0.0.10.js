;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Yao=t()}(this,function(){"use strict";function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function s(){return window.location.href}function a(){return window.navigator.userAgent}var n={base:function(e){return!e.resourceUrl||/\.(dpfile|dianping|51ping|meituan)\.(com|net)/.test(e.resourceUrl)},weixin:function(e){return!/(WeixinJSBridge|_WXJS|WebViewJavascriptBridge)/.test(e.sec_category)},dianping:function(e){return!/document.elementFromPoint/.test(e.sec_category)}};function c(e){var t=a();e.get("devMode")||(e.addFilter("base",n.base),/MicroMessenger/.test(t)?e.addFilter("weixin",n.weixin):/dp\/com\.dianping/.test(t)&&e.addFilter("dianping",n.dianping))}var u="1.8.9";function l(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function p(n){return function e(t){return 0===arguments.length||l(t)?e:n.apply(this,arguments)}}function t(r){return function e(t,n){switch(arguments.length){case 0:return e;case 1:return l(t)?e:p(function(e){return r(t,e)});default:return l(t)&&l(n)?e:l(t)?p(function(e){return r(e,n)}):l(n)?p(function(e){return r(t,e)}):r(t,n)}}}function h(e,f){switch(e){case 0:return function(){return f.apply(this,arguments)};case 1:return function(e){return f.apply(this,arguments)};case 2:return function(e,t){return f.apply(this,arguments)};case 3:return function(e,t,n){return f.apply(this,arguments)};case 4:return function(e,t,n,r){return f.apply(this,arguments)};case 5:return function(e,t,n,r,i){return f.apply(this,arguments)};case 6:return function(e,t,n,r,i,o){return f.apply(this,arguments)};case 7:return function(e,t,n,r,i,o,a){return f.apply(this,arguments)};case 8:return function(e,t,n,r,i,o,a,s){return f.apply(this,arguments)};case 9:return function(e,t,n,r,i,o,a,s,c){return f.apply(this,arguments)};case 10:return function(e,t,n,r,i,o,a,s,c,u){return f.apply(this,arguments)};default:throw Error("First argument to _arity must be a non-negative integer no greater than ten")}}var g=t(function(e,t){return 1===e?p(t):h(e,function o(a,s,c){return function(){for(var e=[],t=0,n=a,r=0;r<s.length||t<arguments.length;){var i;s.length<=r||l(s[r])&&t<arguments.length?(i=arguments[t],t+=1):i=s[r],l(e[r]=i)||(n-=1),r+=1}return 0<n?h(n,o(a,e,c)):c.apply(this,e)}}(e,[],t))});function e(o){return function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return l(n)?e:t(function(e,t){return o(n,e,t)});case 2:return l(n)&&l(r)?e:l(n)?t(function(e,t){return o(e,r,t)}):l(r)?t(function(e,t){return o(n,e,t)}):p(function(e){return o(n,r,e)});default:return l(n)&&l(r)&&l(i)?e:l(n)&&l(r)?t(function(e,t){return o(e,t,i)}):l(n)&&l(i)?t(function(e,t){return o(e,r,t)}):l(r)&&l(i)?t(function(e,t){return o(n,e,t)}):l(n)?p(function(e){return o(e,r,i)}):l(r)?p(function(e){return o(n,e,i)}):l(i)?p(function(e){return o(n,r,e)}):o(n,r,i)}}}var d=e(function(e,t,n){if(n.length<=e||e<-n.length)return n;var r=(e<0?n.length:0)+e,i=function(e,t){var n,r=(e=e||[]).length,i=(t=t||[]).length,o=[];for(n=0;n<r;)o[o.length]=e[n],n+=1;for(n=0;n<i;)o[o.length]=t[n],n+=1;return o}(n);return i[r]=t(n[r]),i}),y=Array.isArray||function(e){return null!=e&&0<=e.length&&"[object Array]"===Object.prototype.toString.call(e)};function v(r,i,o){return function(){if(0===arguments.length)return o();var e=Array.prototype.slice.call(arguments,0),t=e.pop();if(!y(t)){for(var n=0;n<r.length;){if("function"==typeof t[r[n]])return t[r[n]].apply(t,e);n+=1}if(function(e){return null!=e&&"function"==typeof e["@@transducer/step"]}(t))return i.apply(null,e)(t)}return o.apply(this,arguments)}}function m(e){return e&&e["@@transducer/reduced"]?e:{"@@transducer/value":e,"@@transducer/reduced":!0}}var w=function(){return this.xf["@@transducer/init"]()},b=function(e){return this.xf["@@transducer/result"](e)};function S(e,t){for(var n=0,r=t.length,i=Array(r);n<r;)i[n]=e(t[n]),n+=1;return i}function k(e){return"[object String]"===Object.prototype.toString.call(e)}var T=p(function(e){return!!y(e)||!!e&&("object"==typeof e&&(!k(e)&&(1===e.nodeType?!!e.length:0===e.length||0<e.length&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))}),E=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();var O=t(function(e,t){return h(e.length,function(){return e.apply(t,arguments)})});function x(e,t,n){for(var r=n.next();!r.done;){if((t=e["@@transducer/step"](t,r.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r=n.next()}return e["@@transducer/result"](t)}function M(e,t,n,r){return e["@@transducer/result"](n[r](O(e["@@transducer/step"],e),t))}var C="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function I(e,t,n){if("function"==typeof e&&(e=function(e){return new E(e)}(e)),T(n))return function(e,t,n){for(var r=0,i=n.length;r<i;){if((t=e["@@transducer/step"](t,n[r]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return M(e,t,n,"fantasy-land/reduce");if(null!=n[C])return x(e,t,n[C]());if("function"==typeof n.next)return x(e,t,n);if("function"==typeof n.reduce)return M(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}var N=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=w,e.prototype["@@transducer/result"]=b,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}(),_=t(function(e,t){return new N(e,t)});function j(e,t){return Object.prototype.hasOwnProperty.call(t,e)}function A(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1}var P=Object.prototype.toString,R=function(){return"[object Arguments]"===P.call(arguments)?function(e){return"[object Arguments]"===P.call(e)}:function(e){return j("callee",e)}}(),F=!{toString:null}.propertyIsEnumerable("toString"),U=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],D=function(){return arguments.propertyIsEnumerable("length")}(),L=p("function"!=typeof Object.keys||D?function(e){if(Object(e)!==e)return[];var t,n,r=[],i=D&&R(e);for(t in e)!j(t,e)||i&&"length"===t||(r[r.length]=t);if(F)for(n=U.length-1;0<=n;)j(t=U[n],e)&&!A(r,t)&&(r[r.length]=t),n-=1;return r}:function(e){return Object(e)!==e?[]:Object.keys(e)}),q=t(v(["fantasy-land/map","map"],_,function(n,r){switch(Object.prototype.toString.call(r)){case"[object Function]":return g(r.length,function(){return n.call(this,r.apply(this,arguments))});case"[object Object]":return I(function(e,t){return e[t]=n(r[t]),e},{},L(r));default:return S(n,r)}})),B=t(function(e,t){for(var n=t,r=0;r<e.length;){if(null==n)return;n=n[e[r]],r+=1}return n}),H=e(I),J=p(function(e){return function(){return e}});var W=p(function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function Y(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function z(n,r){return function(){var e=arguments.length;if(0===e)return r();var t=arguments[e-1];return y(t)||"function"!=typeof t[n]?r.apply(this,arguments):t[n].apply(t,Array.prototype.slice.call(arguments,0,e-1))}}var X=p(z("tail",e(z("slice",function(e,t,n){return Array.prototype.slice.call(n,e,t)}))(1,1/0)));function G(e){if(0===arguments.length)throw Error("pipe requires at least one argument");return h(e.length,H(Y,e,X(arguments)))}var V=t(function(e,t){var n=e<0?t.length+e:e;return k(t)?t[0|n]:t[n]});function Q(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function $(e,t,n){for(var r=0,i=n.length;r<i;){if(e(t,n[r]))return!0;r+=1}return!1}var Z="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};function K(e,t,n,r){var i=Q(e);function o(e,t){return ee(e,t,n.slice(),r.slice())}return!$(function(e,t){return!$(o,t,e)},Q(t),i)}function ee(e,t,n,r){if(Z(e,t))return!0;var i=W(e);if(i!==W(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(i){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===function(e){var t=(e+"").match(/^function (\w*)/);return null==t?"":t[1]}(e.constructor))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!Z(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!Z(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var o=n.length-1;0<=o;){if(n[o]===e)return r[o]===t;o-=1}switch(i){case"Map":return e.size===t.size&&K(e.entries(),t.entries(),n.concat([e]),r.concat([t]));case"Set":return e.size===t.size&&K(e.values(),t.values(),n.concat([e]),r.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var a=L(e);if(a.length!==L(t).length)return!1;var s=n.concat([e]),c=r.concat([t]);for(o=a.length-1;0<=o;){var u=a[o];if(!j(u,t)||!ee(t[u],e[u],s,c))return!1;o-=1}return!0}var te=t(function(e,t){return ee(e,t,[],[])});function ne(e,t){return 0<=function(e,t,n){var r,i;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(r=1/t;n<e.length;){if(0===(i=e[n])&&1/i==r)return n;n+=1}return-1}if(t==t)return e.indexOf(t,n);for(;n<e.length;){if("number"==typeof(i=e[n])&&i!=i)return n;n+=1}return-1;case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(te(e[n],t))return n;n+=1}return-1}(t,e,0)}function re(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}function ie(e){return(e<10?"0":"")+e}var oe="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+ie(1+e.getUTCMonth())+"-"+ie(e.getUTCDate())+"T"+ie(e.getUTCHours())+":"+ie(e.getUTCMinutes())+":"+ie(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};var ae=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=w,e.prototype["@@transducer/result"]=b,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}(),se=t(v(["filter"],t(function(e,t){return new ae(e,t)}),function(n,r){return function(e){return"[object Object]"===Object.prototype.toString.call(e)}(r)?I(function(e,t){return n(r[t])&&(e[t]=r[t]),e},{},L(r)):function(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}(n,r)})),ce=t(function(e,t){return se(function(e){return function(){return!e.apply(this,arguments)}}(e),t)});function ue(e,t){if(!t)return e;var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(r+"="+t[r]);return~e.indexOf("?")?e+"&"+n.join("&"):e+"?"+n.join("&")}function fe(){}var le=p(function(e){return function n(r,i){function o(e){var t=i.concat([r]);return ne(e,t)?"<Circular>":n(e,t)}function e(t,e){return S(function(e){return re(e)+": "+o(t[e])},e.slice().sort())}switch(Object.prototype.toString.call(r)){case"[object Arguments]":return"(function() { return arguments; }("+S(o,r).join(", ")+"))";case"[object Array]":return"["+S(o,r).concat(e(r,ce(function(e){return/^\d+$/.test(e)},L(r)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof r?"new Boolean("+o(r.valueOf())+")":""+r;case"[object Date]":return"new Date("+(isNaN(r.valueOf())?o(NaN):re(oe(r)))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof r?"new Number("+o(r.valueOf())+")":1/r==-1/0?"-0":r.toString(10);case"[object String]":return"object"==typeof r?"new String("+o(r.valueOf())+")":re(r);case"[object Undefined]":return"undefined";default:if("function"==typeof r.toString){var t=""+r;if("[object Object]"!=t)return t}return"{"+e(r,L(r)).join(", ")+"}"}}(e,[])}),pe=t(function(e,t){return null==t||t!=t?e:t}),he=function(){function e(e,t){this.xf=t,this.f=e,this.found=!1}return e.prototype["@@transducer/init"]=w,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,void 0)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.found=!0,e=m(this.xf["@@transducer/step"](e,t))),e},e}(),ge=t(v(["find"],t(function(e,t){return new he(e,t)}),function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}})),de=function(){function e(e,t){this.xf=t,this.f=e,this.idx=-1,this.found=!1}return e.prototype["@@transducer/init"]=w,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,-1)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.idx+=1,this.f(t)&&(this.found=!0,e=m(this.xf["@@transducer/step"](e,this.idx))),e},e}(),ye=t(v([],t(function(e,t){return new de(e,t)}),function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return n;n+=1}return-1})),ve=e(function(e,t,n){return g(Math.max(e.length,t.length,n.length),function(){return e.apply(this,arguments)?t.apply(this,arguments):n.apply(this,arguments)})}),me=t(function(t,n){return g(t+1,function(){var e=arguments[t];if(null!=e&&function(e){return"[object Function]"===Object.prototype.toString.call(e)}(e[n]))return e[n].apply(e,Array.prototype.slice.call(arguments,0,t));throw new TypeError(le(e)+' does not have a method named "'+n+'"')})}),we=me(1,"join"),be=e(function(e,t,n){return te(t,n[e])}),Se=e(function(e,t,n){return n.replace(e,t)}),ke=me(1,"split"),Te=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=w,e.prototype["@@transducer/result"]=b,e.prototype["@@transducer/step"]=function(e,t){return this.f(t),this.xf["@@transducer/step"](e,t)},e}(),Ee=t(v([],t(function(e,t){return new Te(e,t)}),function(e,t){return e(t),t})),Oe=p(function(e){var t=[];for(var n in e)j(n,e)&&(t[t.length]=[n,e[n]]);return t}),xe=G(ke("?"),V(0),Se(/\/\w{30,}/g,"/:wid"),Se(/\/\d+/g,"/:id"),Se(/\d{4,}/g,":id")),Me=G(function(e){return e.split("#")[0]},ue,xe),Ce=G(Oe,q(function(e){return"".concat(e[0],"=").concat(encodeURIComponent(e[1]))}),we("&"));function Ie(e){if(e){var t,n=a(),r=!(!~window.navigator.appName.indexOf("Microsoft Internet Explorer")||!~n.indexOf("MSIE 8.0")&&!~n.indexOf("MSIE 9.0"))&&window.XDomainRequest;if((t=r?new XDomainRequest:new XMLHttpRequest).open(e.type||"GET",e.url,!0),t.success=e.success||fe,t.fail=e.fail||fe,"POST"===e.type){if(e.header&&!r)for(var i in e.header)e.header.hasOwnProperty(i)&&t.setRequestHeader(i,e.header[i]);t.send(e.data)}else t.send();return t}}function Ne(e,t){var n,r={};for(n in e)r[n]=e[n];for(n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(r[n]=t[n]);return r}var _e={devMode:!1,setDebug:function(){this.devMode=!0},ignore:function(){window.Yao&&window.Yao.debugLog&&(window.console.log("銆怬WL鏃ュ織:銆�"),window.console.log&&window.console.log.apply(window.console,arguments))},log:function(){this.devMode&&console.log.apply(console,arguments)},logScreen:function(){window.Yao&&window.Yao.cfgManager.get("page")&&window.Yao.cfgManager.get("page").logFirstScreen&&console.log.apply(console,arguments)}};function je(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ae(e,t){var n=ke("|",t),r=G(H(function(e,t){return d(t.position,J(t.duration),e)},n),q(function(e){return te(e,"N")?"":e}))(e);return we("|",r)}function Pe(e,t,n){var r=arguments.length<=1||void 0===t||t,i=2<arguments.length?n:void 0;if(e){var o={appkey:Je.getInstance().get("project"),v:"1",unionId:"",speedInfos:JSON.stringify([{speed:{pageUrl:G(s,Me)(),timestamp:+new Date,speed:e.pageSpeed,customSpeed:e.customSpeed,noCache:r}}])},a="https://monitor.maoyan.com";return Je.getInstance().get("devMode")&&(a="http://mymonitor.movie.dev.sankuai.com"),Ie({type:"POST",url:a+="/api/speed",header:{"Content-Type":"application/x-www-form-urlencoded"},data:Ce(o),success:i||Ee})}}function Re(e){return G(function(){return function(e,t){for(var n=(e.split("?")[1]||"").split("&"),r=0;r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])==t)return decodeURIComponent(i[1])}}(e,"yao")},parseInt)()}function Fe(){if(ze&&!("_yao"in ze)&&(ze._yao=!0,"file:"!==Ye.location.protocol)){var r=ze.prototype.open,o=ze.prototype.send;ze.prototype.open=function(e,t){var n=arguments.length<=2||void 0===arguments[2]||arguments[2];return this.url=t,this._startTime=+new Date,this.yaoIndex=Re(this.url),r.call(this,e,function(e,t){var n=e.split("?");if(n.length<2)return e;for(var r=encodeURIComponent(t)+"=",i=n[1].split(/[&;]/g),o=i.length;0<o--;)~i[o].lastIndexOf(r,0)&&i.splice(o,1);return n[0]+(0<i.length?"?"+i.join("&"):"")}(this.url,"yao"),n)},ze.prototype.send=function(){function t(e){if(e&&n.yaoIndex){var t=+new Date-n._startTime;Pe({pageSpeed:"",customSpeed:Ae([{position:n.yaoIndex,duration:e.duration=t}],We())})}}var n=this,e="addEventListener",r="onreadystatechange";if(e in this)this[e]("load",t),this[e]("error",t),this[e]("abort",t);else{var i=this[r];this[r]=function(e){4===this.readyState&&t(e),i&&i.apply(this,arguments)}}return o.apply(this,arguments)}}}function Ue(e){var t=Ve[e];return function(){var e=t.apply(Ve,arguments);return Xe.trigger.apply(Xe,[Ge.HISTORY_CHANGE].concat(Array.prototype.slice.call(arguments))),e}}var De=function(){return je()+je()+"-"+je()+"-"+je()+"-"+je()+"-"+je()+je()+je()},Le=window.location.protocol?window.location.protocol:"http:",qe=(Le=/http/.test(Le)?Le:"http:",["region","operator","network","container","os","unionId"]),Be=Le+"//catfront.dianping.com",He=Le+"//catfront.51ping.com",Je=function(){function t(e){i(this,t),this.url=Be,this.filters=[],this._config={devMode:!1,project:"",pageUrl:"",logan:{enable:!1},disabledFilters:[],noScriptError:!0,ignoreList:{js:["Illegal invocation"],ajax:["https?://report.meituan.com/"],resource:["https?://hls.dianping.com/","https?://frep.meituan.net/"]},resourceReg:/(.51ping|.dianping|.dpfile|.meituan|.sankuai|.kuxun|.maoyan|.neixin|.mobike)/,disableCache:!1,invalid:{ajax:!0},autoCatch:{page:!0,ajax:!0,js:!0,resource:!0,console:!1,pv:!0},ajax:{invalid:!0,flag:!1,duration:2e3},image:{flag:!1,duration:5e3,fileSize:100,filter:function(){return!1}},resource:{sample:.1,sampleApi:.1,combo:!0,delay:1e3},page:{auto:!0,sample:.5,delay:0,timeThreshold:5,mainResourceNumber:5,sensoryIndex:!0,disableSensoryImageIndex:!1,ignoreIframe:!0,logFirstScreen:!1},error:{sample:1,delay:1e3,combo:!1,maxSize:10240,maxNum:100,maxTime:6e4},metric:{sample:.5,combo:!0,delay:1500},pageId:"owl-"+De()},this.baseQuery={v:1,sdk:u},this.apiPaths={log:"/api/log",error:"/api/log",page:"/api/speed",resource:"/batch",metric:"/api/metric",pv:"/api/pv"},this.extensions={},this.userConfig={},this.config={},e?this.set(e):this.config=this._config}return o(t,[{key:"removeFilter",value:function(e){for(var t=0;t<this.filters.length;t++){if(this.filters[t].key===e)return void this.filters.splice(t,1)}}},{key:"addFilter",value:function(e,t){if(e&&t instanceof Function&&this.config.disabledFilters&&!~this.config.disabledFilters.indexOf(e)){for(var n=-1,r=0;r<this.filters.length;r++){var i=this.filters[r];i.key===e&&(n=r,i.fn=t)}-1===n&&this.filters.push({key:e,fn:t})}}},{key:"get",value:function(e){return e?this.config[e]:this.config}},{key:"set",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){if("devMode"===t&&(this.setApiDomain(e[t]),e[t]&&_e.setDebug()),"ext"===t&&this.setExtension(e[t]),"resourceReg"===t)try{this.userConfig[t]=RegExp(e[t])}catch(e){_e.ignore(e)}"object"!==f(e[t])||e[t]instanceof RegExp||e[t]instanceof Array?this.userConfig[t]=e[t]:"pageUrl"!==t&&(this.userConfig[t]=Ne(this.userConfig[t],e[t]))}this.update()}},{key:"setApiDomain",value:function(e){this.url=e?He:Be}},{key:"getExtension",value:function(e){return e?this.extensions[e]:this.extensions}},{key:"setExtension",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];"latlng"===t?(this.extensions.region=n,this.baseQuery.useLatlng=!0):~qe.indexOf(t)&&(this.extensions[t]=n)}}},{key:"getApiPath",value:function(e){return ue(this.url+this.apiPaths[e],this.baseQuery)}},{key:"update",value:function(){for(var e in this.config=this._config,this.userConfig){var t=this.userConfig[e];this.config[e]="object"!=f(t)||t instanceof RegExp||t instanceof Array?t:Ne(this.config[e],this.userConfig[e])}}}],[{key:"setInstance",value:function(e){this._instance=e}},{key:"getInstance",value:function(){return this._instance}}]),t}(),We=J("N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N|N"),Ye=window,ze=Ye.XMLHttpRequest,Xe={on:function(e,t){if(e){this._events_||(this._events_={});var n=this._events_;n[e]||(n[e]=[]),n[e].push(t)}},trigger:function(e){var t=this._events_;if(e&&t&&t[e])for(var n=t[e],r=n.length,i=Array.prototype.slice.call(arguments,1),o=0;o<r;o++)n[o].apply(this,i)}},Ge={HISTORY_CHANGE:"yao_history_change"},Ve=window.history,Qe=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot"],$e={ERROR:"error",INFO:"info",WARN:"warn",DEBUG:"debug"},Ze={SCRIPT:"jsError",AJAX:"ajaxError",RESOURCE:"resourceError"},Ke=["project","pageUrl","realUrl","resourceUrl","category","sec_category","level","unionId","timestamp","content"],et=["rowNum","colNum","tags"].concat(Ke),tt=function(){function n(e){if(i(this,n),e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.parse(e)}}return o(n,[{key:"parse",value:function(){this.category||(this.category=Ze.SCRIPT),this.level||(this.level=$e.ERROR),this.timestamp||(this.timestamp=+new Date),this.sec_category||(this.sec_category="default")}},{key:"isEqual",value:function(e){return this.sec_category===e.sec_category&&this.resourceUrl===e.resourceUrl&&this.colNum===e.colNum&&this.rowNum===e.rowNum&&this.content===e.content}},{key:"update",value:function(e){for(var t in e)void 0!==e[t]&&~et.indexOf(t)&&(this[t]=e[t]);return this}},{key:"updateTags",value:function(e){var t=Ne(this.tags||{},e);return this.tags=t,this}},{key:"toJson",value:function(){var t=this,e=this.rowNum,n=this.colNum,r={};return Ke.map(function(e){void 0!==t[e]&&(r[e]=t[e])}),r.category===Ze.SCRIPT&&e&&n&&(r.dynamicMetric={rowNum:e,colNum:n}),this.tags&&(r.dynamicMetric=Ne(r.dynamicMetric||{},this.tags)),r}}]),n}();tt.LEVEL=$e,tt.CATEGORY=Ze;var nt,rt="owl_cache",it={isSupport:function(){var e="local_test";try{localStorage.setItem(e,1),localStorage.removeItem(e)}catch(e){return!1}return!0}(),get:function(){if(this.isSupport){var e=[];try{var t=localStorage.getItem(rt);t&&(e=JSON.parse(t))}catch(e){_e.ignore(e)}return e}},add:function(e){if(this.isSupport&&e instanceof Array){var t=this.get();e=e.concat(t);try{localStorage.setItem(rt,JSON.stringify(e))}catch(e){_e.ignore(e)}}},clear:function(){if(this.isSupport)try{localStorage.removeItem(rt)}catch(e){_e.ignore(e)}}},ot=[];function at(e){return"c="+encodeURIComponent(JSON.stringify(e))}function st(e){var t=0<arguments.length&&void 0!==e?e:{};if(t&&t.data)return t.beforeSend&&t.beforeSend(),Ie({type:"POST",url:t.url,header:{"Content-Type":"application/x-www-form-urlencoded"},data:at(t.data),success:t.success,fail:t.fail})}function ct(){return function(e){return document.querySelectorAll("[".concat(e,"]"))}("data-yao")}function ut(e){e=e||We();var t=ve(B(["performance","getEntriesByType"]),function(){return function(e){return window&&window.performance&&window.performance?window.performance.getEntriesByType(e):[]}("resource")},J(null))(window),n=function(r,e){var t=G(H(function(e,t){var n=ge(be("name",t.src))(r);return n&&e.push({position:parseInt(t.dataset.yao),src:n.name,duration:parseInt(n.duration)}),e},[]))(e);G(se(function(e){return!~ye(be("src",e.src))(t)}),q(function(e){return{position:parseInt(e.dataset.yao),src:e.src,duration:"X"}}))(e);return t}(pe([])(t),ct());return Ae(n,e)}var ft=!1,lt={queue:[],ready:function(e){var t=this,n=0<arguments.length&&void 0!==e?e:{},r=n.LoganAPI,i=n.pageUrl,o=n.project,a=n.loganConfig;ft=!0;function s(){for(a&&(nt=nt.config(a)),nt.log("[鏂伴」鐩甝: 椤圭洰-> ".concat(o," 瀵瑰簲鐨勯〉闈�-> ").concat(i," "));t.queue.length;){var e=t.queue.shift();nt.log(e)}}if(r)nt=r,s();else try{window&&window.Logan?(nt=window.Logan,s()):function(e,t){if(~ot.indexOf(e))t();else{var n=document.createElement("script");n.src=e,n.onload=function(){ot.push(e),t()},document.getElementsByTagName("head")[0].appendChild(n)}}("//www.dpfile.com/app/dp-logan-web/logan_1.12.5.js",function(){nt=window.Logan,s()})}catch(e){console.log("logan 鍔犺浇澶辫触")}},log:function(e,t){if(ft){var n="owl";(1<arguments.length&&void 0!==t?t:{}).noType&&(n="owl"),nt?nt.log(e,n):this.queue.push(e)}}},pt="error",ht=function(){function n(e,t){i(this,n),this.parent=t,this.cfgManager=e,this.cache=[],this.cacheSending={},this.comboTimeout=0,this.timeLimit=Date.now(),this.errorCount=0,this.isTimeLimit=!1,this.detectLeave()}return o(n,[{key:"_handleError",value:function(t){try{var e=this.cfgManager.get("onErrorPush");if(e instanceof Function&&(t=e(t)),t instanceof tt||void 0===t)return t;_e.ignore("onErrorPush鏂规硶杩斿洖缁撴灉鏈夎")}catch(e){return _e.ignore("onErrorPush鏂规硶澶勭悊鏈夎",e),t}}},{key:"parseWindowError",value:function(e,t,n,r,i){try{i&&i.stack?this.push(i):"string"==typeof e&&this._push({category:Ze.SCRIPT,sec_category:e,resourceUrl:t,rowNum:n,colNum:r})}catch(e){this.reportSystemError(e)}}},{key:"parsePromiseUnhandled",value:function(e){if(e)try{var t=e.reason;t&&(t instanceof Error&&(t=""+t),this._push({category:Ze.SCRIPT,sec_category:"unhandledrejection",content:t}))}catch(e){_e.ignore(e)}}},{key:"parseConsoleError",value:function(){try{var e=[].slice.call(arguments);if(!e||!e.length)return;for(var t=[],n=0;n<e.length;n++){var r=e[n];"string"!=typeof e[n]&&(r=e[n]instanceof window.Error?JSON.stringify(e[n].stack):JSON.stringify(e[n])),t.push(r)}t&&t.length&&this._push({category:Ze.SCRIPT,sec_category:"consoleError",content:t.join(" ")})}catch(e){this.reportSystemError(e)}}},{key:"detectLeave",value:function(){var u=this,f=arguments;try{var l=window.onbeforeunload;window.onbeforeunload=function(){var e,t=u.addCacheExtension(),n=u.cacheSending;if(Object.keys(n))for(var r in n)if(n.hasOwnProperty(r)&&void 0!==n[r]){var i=n[r],o=i.xhr,a=i.cache;try{o.abort()}catch(e){_e.ignore(e)}e=t.concat(a)}if(e&&e.length)if(window.navigator.sendBeacon&&u.cfgManager.get("useSendBeacon")){var s=u.cfgManager.getApiPath(pt),c=ue(s,{beacon:1});window.navigator.sendBeacon(c,at(e))}else u.cfgManager.get("disableCache")||it.add(e);l&&l.apply(u,f)}}catch(e){_e.ignore(e)}}},{key:"checkCache",value:function(){var e=this;if(!this.cfgManager.get("disableCache")){var t=it.get();t&&t.length&&setTimeout(function(){st({url:e.cfgManager.getApiPath(pt),data:t,success:function(){it.clear()}})},1500)}}},{key:"reportSystemError",value:function(e){e&&e.stack&&(this.cache.push(new tt({project:"yao",pageUrl:"default",realUrl:s(),sec_category:e.msg||e.name||"parseError",content:JSON.stringify(e.stack)})),this.send(!0))}},{key:"_processError",value:function(t){function u(e){var t="object"===f(e)?JSON.stringify(e):e;return{category:Ze.SCRIPT,sec_category:"Invalid_Error",content:t}}try{return function(e){var t=e.line,n=e.column,r=e.message||e.name||"";if(e.stack){var i=e.stack.match("https?://[^\n]+"),o=/https?:\/\/(\S)*\.js/,a="";o.test(i=i?i[0]:"")&&(a=i.match(o)[0]);var s=i.match(":(\\d+):(\\d+)");s=s||[0,0,0];var c=function(e){return e&&e.stack||""}(e);return{category:Ze.SCRIPT,sec_category:r,content:c,rowNum:void 0!==t?t:s[1],colNum:void 0!==n?n:s[2],resourceUrl:a}}return u(e)}(t)}catch(e){return this.reportSystemError(t),u(t)}}},{key:"_push",value:function(e,t){e=this.parse(e),this.push(new tt(e),t)}},{key:"_pushResource",value:function(){var e=this.cfgManager.get("resource").sample;Math.random()>e||this._push.apply(this,arguments)}},{key:"parse",value:function(e){return e.project||(e.project=this.cfgManager.get("project")),e.pageUrl||(e.pageUrl=this.cfgManager.get("pageUrl")||"default"),e.unionId||(e.unionId=this.cfgManager.getExtension("unionId")),e.realUrl=s(),e}},{key:"push",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=this.cfgManager;if(e&&Math.random()<=r.get(pt).sample)if(e instanceof tt||(e instanceof Error?e=this._processError(e):"string"==typeof e?e={sec_category:e}:"object"===f(e)&&(e={sec_category:e.name,content:e.msg}),e=this.parse(e),e=new tt(e)),e&&e.content&&e.content.length>=r.get(pt).maxSize)lt.log("[Error]: 閿欒闀垮害澶т簬".concat(r.get(pt).maxSize));else{e.update(n),lt.log("[Error]: 閿欒绫诲埆->".concat(e.sec_category," 閿欒鍫嗘爤->").concat(e.content));var i=r.filters,o=!0;if(this.cfgManager.get("noScriptError")&&!e.sec_category.indexOf("Script error"))return!1;if(i&&i.length)for(var a=0;a<i.length;a++){if(!i[a].fn(e))return!1}var s=r.get("ignoreList").js;if(s&&s.length)for(var c=0;c<s.length;c++){if(!e.sec_category.indexOf(s[c])){o=!1;break}}o&&(this.isExist(e)||(this.onPush&&this.onPush(e),(e=this._handleError(e))&&(this.cache.push(e),this.send())))}}},{key:"isExist",value:function(e){for(var t=0;t<this.cache.length;t++){var n=this.cache[t];if(n instanceof tt||(n=new tt(n)),n.isEqual(e))return!0}return!1}},{key:"report",value:function(){this.push.apply(this,arguments),this.send(!0)}},{key:"send",value:function(e){var r=this,i=this.cfgManager,o=this.comboTimeout,a=i.get("error").maxNum||100,s=i.get("error").maxTime||6e4,c=Date.now()-this.timeLimit;this.isTimeLimit||(this.timeLimit=Date.now()),this.isTimeLimit=!0;function t(){if(r.cache.length){clearTimeout(o),o=0,r.onSubmit&&r.onSubmit(r.cache);var e=r.addCacheExtension(),t=+new Date;try{if(r.errorCount=r.errorCount+r.cache.length,s<c)r.isTimeLimit=!1,r.errorCount=0;else if(a<=r.errorCount)return}catch(e){_e.ignore(e)}var n=st({url:r.cfgManager.getApiPath(pt)+"&pageId=".concat(i.get("pageId")),data:e,success:function(){r.nextCache=[],r.cacheSending[t]=void 0},fail:function(){r.cfgManager.get("disableCache")||it.add(r.nextCache)}});r.cacheSending[t]={xhr:n,cache:e},r.nextCache=e,r.cache=[]}}var n=i.get(pt).delay;e?t():o||-1===n||(o=setTimeout(t,n))}},{key:"addCacheExtension",value:function(){var e=this.cache,t=[],n=this.cfgManager.getExtension();if(!e||!e.length)return t;for(var r=0;r<e.length;r++){var i=e[r];n&&"object"===f(n)&&(i=Ne(i.toJson(),n)),t.push(i)}return t}}]),n}();function gt(e){return e&&"data:image"===e.slice(0,10)}function dt(e,t){if("IMG"==e.nodeName.toUpperCase())return e.getAttribute("data-srcset")||e.getAttribute("src");var n=window.getComputedStyle(e);return function(e,t){var n,r=e.match(/url\(.*?\)/g);if(r&&r.length){var i=r[r.length-1].replace(/^url\([\'\"]?/,"").replace(/[\'\"]?\)$/,"");t.test(i)&&!gt(i)&&(n=i)}return n}(n.getPropertyValue("background-image")||n.getPropertyValue("background"),t)}function yt(e,t){if(!e)return!1;var n=e.getBoundingClientRect(),r=n.top,i=n.left,o=n.right;return!(!r&&!n.bottom)&&((t?document.getElementById(t).scrollTop:window.scrollY||window.pageYOffset)+r<window.innerHeight&&0<o&&i<window.innerWidth)}var vt={getImageTimingsInFirstScreen:function(e,t,n){if(!window.performance||!window.performance.getEntriesByType)return[];var r=[];try{var i=window.performance.getEntriesByType("resource").filter(function(e){return"img"===e.initiatorType||"css"===e.initiatorType}).map(function(e){return{name:e.name.split(":")[1]||e.name,responseEnd:e.responseEnd,connectEnd:e.connectEnd,duration:e.duration}}),o=function(t,e,n){var r,i,o=[];try{for(var a=document.createNodeIterator(document.body,NodeFilter.SHOW_ELEMENT,function(e){if(e&&e.getAttribute&&!e.hasAttribute("".concat(t)))return NodeFilter.FILTER_ACCEPT},!1),s=a.nextNode();s;){var c=dt(s,e);c?(yt(s,n)&&!gt(c)&&o.push((r=c,i=void 0,(i=document.createElement("a")).href=r,i.href)),s=a.nextNode()):s=a.nextNode()}}catch(e){console.log("getDomImgs err")}return o}(e,t,n).join("###");return r=i.filter(function(e){return!!~o.indexOf(e.name)}).map(function(e){return{name:e.name,time:e.responseEnd||e.connectEnd+e.duration}}).sort(function(e,t){return t.time-e.time}),_e.logScreen("棣栧睆鍐呭浘鐗囩殑鍔犺浇鏃堕棿",r),r.map(function(e){return e.time})}catch(e){r=[]}return r},isInFirstScreen:yt};var mt,wt,bt,St,kt,Tt,Et,Ot=[],xt=-1,Mt=!1,Ct=!1,It=!1,Nt=0,_t=0,jt=1,At=3,Pt=["HTML","HEAD","SCRIPT","STYLE"],Rt=Array.prototype.slice,Ft=Number.parseInt||window.parseInt,Ut=(Tt={height:window.outerHeight||screen.height,width:window.outerWidth||screen.width},Et=document.documentElement||document.body,[window.innerWidth,Et.clientWidth].filter(function(e){return e&&Tt.width<e&&2<=e/Tt.width}).forEach(function(e){var t=e/Tt.width;Tt.height=Tt.height*t,Tt.width=Tt.width*t}),Tt),Dt=Ut.height,Lt=Ut.width,qt=function(){function t(e){i(this,t),this.cfgManager=e,this.pageData=[],this.observer=null,this.disableMutaObserver=null,this.perObserver=null,this.ignoreDom="owl-ignore",this.ignoreIframe=e.get("page").ignoreIframe||!0,this.pattern=/(\.)(png|jpg|jpeg|gif|webp|ico|bmp|tiff|svg)/i,kt=e.get("page").scrollDom,!this.disableMutaObserver&&document.body||(It=Ct=!0)}return o(t,[{key:"spaFirstScreen",value:function(e){Ct=!(Ot=[]),this.observer=null,this.spaFirstScreenCb=e,this.mutaObserver()}},{key:"mutaObserver",value:function(){var t=this;if(function(){if(window.performance&&window.performance.now)return!0}()&&function(){if(window.MutationObserver)try{var e=-1,t=a();if(~t.indexOf("compatible")&&~t.indexOf("MSIE")?e=parseFloat(RegExp.$1):~t.indexOf("Trident")&&~t.indexOf("rv:11.0")&&(e=11),-1===e||11<e)return!0}catch(e){}}()){if(!Ct){if(this.observer)try{this.observer.disconnect(),this.observer=null,this.pageData&&this.pageData.length&&this.pageData.forEach(function(e){t.mutaCallback(e.mutations,e.startTime)})}catch(e){console.log("observer disconnect err")}try{this.observer=new MutationObserver(function(e){t.mutaCallback(e,performance.now())}),this.observer.observe(document,{childList:!0,subtree:!0}),St=setTimeout(function(){Bt(t.spaFirstScreenCb)},3e3)}catch(e){console.log(e),console.log("observer observe err")}}if(bt=this.cfgManager.get("page").disableSensoryImageIndex)return void(It=!0);this.registerPerformanceObserver()}}},{key:"registerPerformanceObserver",value:function(){var e=this,t=this.cfgManager.get("resource").disablePerformanceObserver||!1;if(function(){if(window.PerformanceObserver)try{var e=/Chrome\/(\d+)/,t=a();if(!e.test(t))return!0;var n=t.match(e)[1];if(59<parseInt(n))return!0}catch(e){}}()&&!0!==t){var n=setTimeout(function(){e.performanceObserverStop()},8e3);this.perObserver=new window.PerformanceObserver(function(){clearTimeout(mt),mt=setTimeout(function(){clearTimeout(n),e.performanceObserverStop()},3e3)}),this.perObserver.observe({entryTypes:["resource"]})}else It=!0}},{key:"getSensoryIndex",value:function(e){var t=this,n=0,r=setTimeout(function(){clearInterval(n),t.mutaObserverStop(),t.performanceObserverStop(),e(wt)},1e3);n=setInterval(function(){Ct&&It&&(clearInterval(n),wt?(bt||function(e,t){var n=vt.getImageTimingsInFirstScreen(e,t,kt);if(wt&&n.length){var r=Math.round(n[0]);wt.FST=Math.max(wt.FST,r),_e.logScreen("棣栧睆鍥剧墖鏃堕棿",r),_e.logScreen("鏈€缁堥灞忔椂闂�",wt.FST)}}(t.ignoreDom,t.pattern),clearTimeout(r),e(wt)):(clearTimeout(r),e()))},500)}},{key:"mutaCallback",value:function(e,i){var o=this;i=i||performance.now(),St=St&&clearTimeout(St),Mt&&clearTimeout(Mt),Mt=setTimeout(function(){return o.mutaObserverStop()},3e3),setTimeout(function(){_e.logScreen("DOM鍘熷鍙樻洿锛�".concat(e.length),e),e.filter(function(e){var t=(e.target.nodeName||"").toUpperCase();return"childList"===e.type&&e.addedNodes.length&&!~Pt.indexOf(t)}).forEach(function(e){var t=Rt.call(e.addedNodes,0).filter(function(e){var t=e.nodeName.toUpperCase();return!(1!==e.nodeType||~Pt.indexOf(t)||o.ignoreIframe&&"IFRAME"==t||function(e,t){var n=!1;t&&(n=!(!e.closest||!e.closest("[".concat(t,"]")))||e.hasAttribute&&e.hasAttribute(t));n&&_e.logScreen("蹇界暐鍏冪礌锛�",e);return n}(e,o.ignoreDom))}),n=t[0];if(n){!function(e,t){-1===xt&&(window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("paint")&&document&&document.body&&""!=document.body.innerText?xt=0:(e&&3===e.nodeType||e&&""!==e.innerText||document.querySelector&&document.querySelector("img"))&&(xt=Ft(t||0)))}(n,i),Ot.push({nodes:t,startTime:i});var r=n.getBoundingClientRect&&n.getBoundingClientRect();r&&Dt<r.top&&(15<++Nt&&o.mutaObserverStop(),_e.logScreen("棣栧睆澶栬妭鐐规娴嬶細".concat(Nt,"娆�"))),t.forEach(function(e){document.querySelectorAll&&o.addEventToStopMutation(e)})}})},0)}},{key:"mutaObserverStop",value:function(){this.observer&&this.observer.disconnect&&(this.observer.disconnect(),this.observer=null,Bt(this.spaFirstScreenCb))}},{key:"performanceObserverStop",value:function(){this.perObserver&&this.perObserver.disconnect&&(this.perObserver.disconnect(),this.perObserver=null),It=!0}},{key:"addEventToStopMutation",value:function(e){var n=this;Rt.call(e.querySelectorAll("[interactive]"),0).forEach(function(e){var t=e.getAttribute("interactive")||"click";e.addEventListener(t,function(){n.mutaObserverStop()})})}}]),t}();function Bt(e){Ct||function(e){_e.logScreen("DOM鏈夋晥鍙樻洿锛�".concat(Ot.length),Ot);var i=[];Ot.forEach(function(e){var t=e.startTime,r=[];if(e.nodes.forEach(function(e){var t=e.style||{};if("hidden"!==t.visibility&&"none"!==t.display){var n=e.getBoundingClientRect&&e.getBoundingClientRect();n&&0<n.width+n.height&&n.top<=Dt&&n.left<=Lt&&r.push({node:e,rect:n})}}),r.length){var n=function(e){return e.reduce(function(e,t){return e+function n(e,r){var t=e.node,i=e.rect;var o=t.style||{},a=o.visibility,s=o.display;if("hidden"===a||"none"===s)return 0;if(3===t.nodeType){if(t.textContent){var c=t.textContent.charCodeAt(0);if(10!=c&&13!=c)return r+jt}return 0}if(t.childNodes.length)return Rt.call(t.childNodes,0).reduce(function(e,t){return e+n({node:t},r+_t)},0);var u=i||{width:t.clientWidth,height:t.clientHeight},f=u.width,l=u.height;if(f&&l)return r+jt;return 0}(t,0)},0)}(r);n&&i.push({score:n,startTime:t})}}),Ot=[],Ct=!0,_e.logScreen("DOM鏈夋晥棣栧睆鍙樻洿锛�",i);var t=function(e){var t=e.reduce(function(e,t){var n=e[e.length-1];return n&&t.startTime-n.startTime<1?n.score+=t.score:e.push({score:t.score,startTime:t.startTime}),e},[]);_e.logScreen("DOM鏈夋晥棣栧睆鍙樻洿鍚堝苟锛�",t);var n=t.reduce(function(e,t){return!e||Math.min(e.score,At)<t.score?t:e},null);return Ft(n&&n.startTime||0)}(i);wt={FST:t,FCP:xt||0},_e.logScreen("DOM棣栧睆鏃堕棿",t),"function"==typeof e&&e()}(e)}var Ht="page",Jt=function(){function t(e){i(this,t),this.noCache=!1,this.points=[],this.pointsCustom=[],this.cfgManager=e,this.addHistoryListener()}function e(){return n.apply(this,arguments)}var n;return o(t,[{key:"addHistoryListener",value:function(){var e=this;Xe.on(Ge.HISTORY_CHANGE,function(){e.spaSensoryObserver(function(){return e.spaFirstScreenEnd()})})}},{key:"spaSensoryObserver",value:function(e){this.firstScreenManager||(this.firstScreenManager=new qt(this.cfgManager)),this.spaFirstTime=performance.now(),this.firstScreenManager.spaFirstScreen(e)}},{key:"spaFirstScreenEnd",value:function(){this.isSpa=!0,this.parsePageTimeWithDefer()}},{key:"setUserReady",value:function(){this.cfgManager.set({page:{auto:!0}})}},{key:"getUserReady",value:function(){return this.cfgManager.get(Ht).auto}},{key:"setReady",value:function(){this.isReady=!0}},{key:"getReady",value:function(){return this.isReady}},{key:"getPerformaceTiming",value:function(){return{perf:window.performance&&window.performance.timing,paint:window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("paint")}}},{key:"getMainResourceTiming",value:function(){var e=window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("resource"),t=this.cfgManager.get("page").isMainResource,n=[];try{if(!e)return;if("function"==typeof t){for(var r=0;r<e.length;r++){var i=e[r];t(i)&&n.push(i)}return n}for(var o=0;o<e.length;o++){var a=e[o];"link"!==a.initiatorType&&"script"!==a.initiatorType||n.push(a)}var s=this.cfgManager.get("page").mainResourceNumber;return s<n.length?n.splice(0,s):n}catch(e){_e.ignore(e)}}},{key:"sensoryObserver",value:function(){this.firstScreenManager=new qt(this.cfgManager),this.firstScreenManager.mutaObserver()}},{key:"parsePageTimeWithDefer",value:function(){var t=this;setTimeout(function(){try{var e=t.cfgManager.get("page");e&&e.sensoryIndex?t.firstScreenManager.getSensoryIndex(function(e){t.parsePageTime(e)}):t.parsePageTime()}catch(e){t.parsePageTime()}},0)}},{key:"parsePageTime",value:function(e){var t=this.getPerformaceTiming(),n=t.perf,r=t.paint;if(!n)return this.setReady();var i,o=n.navigationStart,a={unloadEventStart:1,unloadEventEnd:2,redirectStart:3,redirectEnd:4,fetchStart:5,domainLookupStart:6,domainLookupEnd:7,connectStart:8,connectEnd:9,requestStart:10,responseStart:11,responseEnd:12,domLoading:13,domInteractive:14,domContentLoadedEventStart:15,domContentLoadedEventEnd:16,domComplete:17,loadEventStart:18,loadEventEnd:19};for(i in n)this.points[a[i]]=0===n[i]?n[i]:n[i]-o;if(this.points[20]=n.domainLookupEnd-n.domainLookupStart,this.points[21]=n.connectEnd-n.connectStart,this.points[22]=n.responseEnd-n.requestStart,r&&r.length)try{for(var s,c,u=Number.parseInt||window.parseInt,f=0;f<r.length;f++){var l=r[f];"first-paint"===l.name?s=u(l.startTime):"first-contentful-paint"===l.name&&(c=u(l.startTime))}s&&c&&(this.points[23]=s,this.points[24]=c,e&&(this.points[25]=e.FST&&this.isSpa?u(e.FST-this.spaFirstTime,10):e.FST&&c<e.FST?e.FST:c,this.points[26]=e.FCP||c))}catch(e){_e.ignore(e)}else e&&(this.points[25]=e.FST||0,this.points[26]=e.FCP||this.points[15]);for(var p=0;p<this.points.length;p++)isNaN(this.points[p])&&(this.points[p]=0);var h=this.getMainResourceTiming();if(h){for(var g=this.noCache,d=0;d<h.length;d++){var y=h[d];if(void 0!==y.transferSize)0!==y.transferSize&&(g=!0);else if(void 0!==y.duration){this.cfgManager.get("page").timeThreshold<y.duration&&(g=!0)}}this.noCache=g}this.setReady(),this.report()}},{key:"push",value:function(e){this.onPush&&this.onPush(e),e&&"number"==typeof e.position&&(e.position<0||31<e.position||(this.pointsCustom[e.position]=e.duration,this.report()))}},{key:"clearTimeout",value:(n=function(){clearTimeout(this.timeout),this.timeout=void 0},e.toString=function(){return""+n},e)},{key:"report",value:function(e){var t=this,n=this.cfgManager;if(this.getReady()&&this.getUserReady()&&(this.points.length||this.pointsCustom.length)&&Math.random()<=n.get(Ht).sample){this.onSubmit&&this.onSubmit(this.points,this.pointsCustom);try{this.timeout?this.clearTimeout():this.pendingAjax&&this.pendingAjax.abort&&this.pendingAjax.abort()}catch(e){_e.ignore(e)}var r=function(){t.pendingAjax=Pe({pageSpeed:t.points.join("|"),customSpeed:ut()},!!t.noCache,function(){t.points=[],t.pointsCustom=[],t.pendingAjax=void 0})},i=n.get(Ht).delay||0;e?r():i<0||(this.timeout=setTimeout(function(){r()},i))}}}]),t}(),Wt="metric",Yt=function(){function t(e){i(this,t),this.cfgManager=e,this.tags={},this.kvs={},this.extraData="",this.random=Math.random()}return o(t,[{key:"setTags",value:function(e){this.tags=Ne(this.tags,e)}},{key:"getTags",value:function(e){return e?this.tags[e]:this.tags}},{key:"setMetric",value:function(e,t){var n=this;if("string"!=typeof e)return _e.ignore("metric鍚嶇О蹇呴』鏄痵tring绫诲瀷");if("number"!=typeof t)return _e.ignore("metric鍊煎繀椤绘槸number绫诲瀷,褰撳墠涓�".concat(e,"-").concat(t));this.kvs[e]||(this.kvs[e]=[]),this.kvs[e].push(t);try{this.cfgManager.get(Wt).combo&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){n.report()},this.cfgManager.get(Wt).delay||1500))}catch(e){throw e}}},{key:"setExtraData",value:function(e){e&&(this.extraData=e)}},{key:"getMetric",value:function(e){return e?this.kvs[e]:this.kvs}},{key:"clearMetric",value:function(){this.kvs={}}},{key:"_rollbackMetric",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.kvs[t]=e[t].concat(this.kvs[t]||[]))}},{key:"report",value:function(){var e=this,t=this.cfgManager,n=t.get("project");if(this.kvs&&0!==Object.keys(this.kvs).length){var r={kvs:this.kvs,tags:this.tags,ts:parseInt(+new Date/1e3),extraData:this.extraData},i=this.kvs;this.clearMetric();var o=t.getApiPath(Wt);Ie({type:"POST",url:ue(o,{p:n,pageId:t.get("pageId"),unionId:t.getExtension("unionId")}),header:{"Content-Type":"application/x-www-form-urlencoded"},data:"data="+encodeURIComponent(JSON.stringify(r)),fail:function(){e._rollbackMetric(i)}})}}}]),t}();function zt(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i[0];)i=i.substring(1,i.length);if(!i.indexOf(t))return i.substring(t.length,i.length)}return null}var Xt=function(){var e=zt("network");if(!e){var t=a(),n=/NetType\/([a-zA-Z0-9]+)/;t&&n.test(t)&&(e=t.match(n)[1])}var r=zt("uuid")||zt("unionid")||zt("dpid")||zt("_lxsdk_cuid"),i={};return e&&(i.network=e),r&&(i.unionId=r),i},Gt=function(){function r(e,t){i(this,r);var n=new Je(e);Je.setInstance(n),this.errManager=new ht(n,this),this.pageManager=new Jt(n),this.metricManager=new Yt(n),this.cfgManager=n,this.init(),t&&t.noFilter||c(this.cfgManager)}return o(r,[{key:"init",value:function(){this.cfgManager.setExtension(Xt())}},{key:"config",value:function(e){this.cfgManager.set(e)}},{key:"debug",value:function(){this.cfgManager.set({devMode:!0}),_e.setDebug()}},{key:"addError",value:function(e,t){t&&!1===t.combo?this.errManager.report(e,t):!1===this.cfgManager.get("error").combo?this.errManager.report(e,t):this.errManager.push(e,t)}},{key:"sendErrors",value:function(){this.errManager.report()}},{key:"addPoint",value:function(e){var t,n=0<arguments.length&&void 0!==e?e:{},r=this.pageManager.getPerformaceTiming().perf;void 0!==n.duration?t=n:void 0!==r&&(t={position:n.position,duration:(n.timeStamp||+new Date)-r.navigationStart});!function(e){var t=0<arguments.length&&void 0!==e?e:{};(t||t.position||t.duration)&&Pe(function(e,t){return{speed:0<arguments.length&&void 0!==e?e:"",customSpeed:1<arguments.length&&void 0!==t?t:""}}("",Ae([{position:t.position,duration:t.duration}],We())))}(t)}},{key:"sendPoints",value:function(){this.pageManager.report(!0)}},{key:"addApi",value:function(e){if(e){if(void 0!==e.networkCode&&"number"!=typeof e.networkCode)return _e.ignore("缃戠粶鐘舵€佺爜蹇呴』涓篘umber绫诲瀷",JSON.stringify(e));if(void 0!==e.statusCode&&"number"!=typeof e.statusCode)return _e.ignore("涓氬姟鐘舵€佺爜蹇呴』涓篘umber绫诲瀷",JSON.stringify(e));var t;t=e.statusCode?e.statusCode:0===e.statusCode?e.statusCode:"";var n={type:"api",connectType:e.connectType||"",resourceUrl:e.name,statusCode:"".concat(e.networkCode?e.networkCode:0===e.networkCode?e.networkCode:"","|").concat(t),responsetime:e.responseTime&&""+e.responseTime?""+e.responseTime:"0"};e.content&&(n.firstCategory=Ze.AJAX,n.secondCategory=e.secondCategory||e.name,n.logContent=e.content)}}},{key:"reportApi",value:function(){this.addApi.apply(this,arguments)}},{key:"sendApis",value:function(){}},{key:"addLog",value:function(e){if("string"!=typeof e)return"addLog鍙帴鍙梥tring绫诲瀷鐨勬棩蹇�";this.logManager.addLog(e)}},{key:"createLog",value:function(){return new LogManager(this.cfgManager)}},{key:"resetPv",value:function(e){var t=0<arguments.length&&void 0!==e?e:null,n="owl-"+De();t&&t.pageUrl||this.cfgManager.get("pageUrl"),t&&t.project||this.cfgManager.get("project")}},{key:"reportPv",value:function(){this.cfgManager.get("pageId")}},{key:"updateFilter",value:function(e,t){void 0===t?this.cfgManager.removeFilter(e):this.cfgManager.addFilter(e,t)}},{key:"wrap",value:function(t,e,n){if("function"!=typeof t)return t;try{if(t.__owl_wrapped__)return t;if(t.__owl_wrapper__)return t.__owl_wrapper__}catch(e){return t}function r(){try{return t.apply(e,arguments)}catch(e){Vt.addError(e,n)}}for(var i in t)t.prototype.hasOwnProperty(i)&&(r[i]=t[i]);return r.prototype=t.prototype,(t.__owl_wrapper__=r).__owl_wrapper__=!0,r}},{key:"setDimension",value:function(e){this.cfgManager.setExtension(e)}}]),r}(),Vt=new Gt({},{noFilter:!0});return Vt.YAO=Gt,Vt.__version__=u,Vt.errorModel=tt,Vt.MetricManager=function(){return new Yt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:Vt.cfgManager)},Vt.start=function(e){var t=a(),n=!1;Qe.forEach(function(e){~t.indexOf(e)&&(n=!0,_e.ignore("褰撳墠鐜琚垽鏂负鐖櫕锛岀洃鎺у姛鑳藉叧闂�"))}),n||this.isStarted||(this.isStarted=!0,Vt.cfgManager.set({pageUrl:s()}),e&&(e&&e.resource&&e.resource.sample&&(e.resource.sample=void 0),Vt.cfgManager.set(e)),c(Vt.cfgManager),Ve&&("_yao"in Ve||(Ve._yao=!0,Ve.pushState=Ue("pushState"),Ve.replaceState=Ue("replaceState"))),function(e){var t=e.cfgManager;t.get("page").sensoryIndex&&e.sensoryObserver(),t.get("autoCatch").page&&!e.getReady()&&(document&&"complete"===document.readyState?e.parsePageTimeWithDefer():(window.addEventListener||window.attachEvent)("load",function(){e.parsePageTimeWithDefer()}))}(Vt.pageManager),Fe())},Vt});
//# sourceMappingURL=yao-0.0.10.js.map
